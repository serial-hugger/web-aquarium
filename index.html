<!DOCTYPE html>
<html>
<body>
<style>
body {
  background-image: url('pebblebg.png'),url('sandbg.png');
  background-repeat: no-repeat,repeat;
  background-attachment: fixed;
  background-position: center;
  background-size: 1200px 1000px,20% 20%;
}
.aquariumlist {
  margin: auto;
  width: 1024px;
  height:123px;
  display: flex; 
  overflow-x: scroll;
  overflow-y: none;
  border:1px solid #5e5e5e;
  background: #757575;
}
</style>
<div class = "container" id="container" style = "position:relative;">
<canvas id = "selectedaquarium" width = 1023 height = 511.5 style = "border:2px solid #5e5e5e;margin:50px auto auto auto;display: flex;z-index=0"></canvas>
<div class="aquariumlist" id = "aquariums">
</div>
</div>

<script>
var overTank = false;
var cursor = 0;
var debug = document.getElementById("debug");
//the canvas of selected aquarium being displayed
var mainCanvas = document.getElementById("selectedaquarium");
//position of mouse
var mouseX;
var mousePrevX;
var mouseY;
var mousePrevY;
//slot of the item that the mouse is over
var itemSlotOver;
//variables to draw rectangle around item hovered over or selected
var hoverTop;
var hoverLeft;
var hoverWidth;
var hoverHeight;

var movingItemSlot = -1;

var yMult = 1;

//ACTIONS
mainCanvas.addEventListener("mousedown", function(e) 
{ 
	movingItemSlot = itemSlotOver;
	xDebt = 0;
	yDebt = 0;
}); 
mainCanvas.addEventListener("mouseup", function(e) 
{ 
	movingItemSlot = -1;
}); 

mainCanvas.addEventListener("mousemove", function(e) 
{ 
    mouseX = getMousePos(mainCanvas,e).x;
	mouseY = getMousePos(mainCanvas,e).y;
}); 
mainCanvas.addEventListener("mouseout", function(e) 
{ 
	hoverTop = -1000;
	hoverLeft = -1000;
	movingItemSlot = -1;
}); 

//ITEM BANK
var tankItems = [
["image:sb0001.png","type:sandback"],
["image:sf0002.png","type:sandfront"],
["image:dp0003.png","imagef:dp0003f.png","name:Sea Weed","x:31","y:155","width:62","height:169"],
["image:dp0004.png","imagef:dp0004f.png","name:Sea Weed","x:31","y:155","width:62","height:169"],
["image:dp0005.png","imagef:dp0005f.png","name:Sea Weed","x:31","y:155","width:62","height:169"],
["image:dp0006.png","imagef:dp0006f.png","name:Chest","x:74","y:90","width:148","height:127"]
];
var tankImgs = [];

function getMousePos(canvas, evt) {
    var rect = mainCanvas.getBoundingClientRect();
    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
}
function GetImageSlot(imageName){
	if(tankImgs.length > 0){
		for(img = 0; img<tankImgs.length;img++){
			if(tankImgs[img].src.split("/").pop() == imageName){
				return img;
			}
		}
	}
	window.alert("UH OH");
}
function GetItemInfo(info,type){
	var infoList = [];
	for(var i=0;i<info.length;i++){
		var splitted = info[i].split(':');
		if(splitted[0]==type){
			infoList.push(splitted[1]);
			//window.alert(splitted[1]);
		}
	}
	return infoList;
}
function SetItemInfo(info,type,value){
	for(var i=0;i<info.length;i++){
		var splitted = info[i].split(':');
		if(splitted[0]==type){
			info[i] = null;
			info[i] = type.toString() + ":" + value.toString();
			//window.alert(info[i]);
		}
	}
}
function sortFunction(a,b)
{
	return parseInt(a[0].replace(/\D/g,'')) - parseInt(b[0].replace(/\D/g,''));
}
function GetItemAtPos(decorArr,canvas,relSize,xOffset,yOffset,topSand){
	var currentSel = -1;
	for(var i = 0;i<decorArr.length;i++){
		var x = GetItemInfo(decorArr[i],"x");
		var y = GetItemInfo(decorArr[i],"y");
		var z = GetItemInfo(decorArr[i],"z");
		var id = GetItemInfo(decorArr[i],"id");
		var size = GetItemInfo(decorArr[i],"size");
		var left = (canvas.width/2-GetItemInfo(tankItems[id],"x")*(z*(x/-100)/100+size/2)*relSize+x*relSize)-(xOffset/5)*(5-z/10)*relSize;
		var top = (topSand-GetItemInfo(tankItems[id],"y")*(z/100+size/2)*relSize+z*relSize)-((yOffset/25)*(5-z/10)/yMult)*relSize;
		var flip = GetItemInfo(decorArr[i],"flip");
		var imgSlot;
		if(flip == 0){
			imgSlot = GetImageSlot(GetItemInfo(tankItems[parseInt(id)],"image"));
		}else{
			imgSlot = GetImageSlot(GetItemInfo(tankItems[parseInt(id)],"imagef"));
		}
		var iWidth = (tankImgs[imgSlot].width * relSize)*(z/100+size/2);
		var iHeight = (tankImgs[imgSlot].height * relSize)*(z/100+size/2);
		if(mouseX > left && mouseX < left + iWidth && mouseY > top && mouseY < top + iHeight){
			currentSel = i;
		}
	}
	return currentSel;
}

//TANK CONTENTS
var tankDecor = [,];


var aquariums = [];
var selectedTank = 0;
for(i = 0; i < 10; i++){
	CreateTank(i);
}
function CreateTank(tank){
	var canvas = document.createElement("canvas");
	canvas.id = ("aquarium" + tank);
	canvas.width = 200;
	canvas.height = 100;
	canvas.style = "border:2.5px solid #303030";
	document.getElementById("aquariums").appendChild(canvas);
	aquariums.push(canvas);
	canvas.addEventListener("mousedown", function(e) 
	{ 
		selectedTank = tank;
		overTank = false;
	}); 
	canvas.addEventListener("mouseenter", function(e) 
	{ 
		if(selectedTank != tank){
			overTank = true;
		}
	}); 
	canvas.addEventListener("mouseleave", function(e) 
	{ 
		overTank = false;
	});
}
function DecorateTank(tank){
	var currentDecor = [];
	tankDecor[tank] = [];
	for(z=0;z<50;z+=getRandomInt(2,3)){
		var random;
		if(getRandomInt(0,100)<90){
			random = getRandomInt(2,4);
		}else{
			random = 5;
		}
		currentDecor.push("z:"+z.toString());
		currentDecor.push("id:"+random.toString());
		currentDecor.push("x:"+getRandomInt(-300,300).toString());
		currentDecor.push("y:0");
		currentDecor.push("size:"+(getRandomInt(8,12)/10).toString());
		currentDecor.push("flip:"+(getRandomInt(0,1)).toString());
		tankDecor[tank].push(currentDecor);
		currentDecor = [];
	}
}
function DecorateAll(){
	for(i = 0; i<aquariums.length;i++){
		DecorateTank(i);
	}
	//window.alert(tankDecor);
}
function DrawTankItems(tank,decorArr,canvas,relSize,xOffset,yOffset){
	var canvas = canvas;
	var ctx = canvas.getContext("2d")
	if(tank == selectedTank){
		itemSlotOver = GetItemAtPos(decorArr,canvas,relSize,xOffset,yOffset);
	}
	for(var i=0;i<decorArr.length;i++){
		var x = GetItemInfo(decorArr[i],"x");
		var y = GetItemInfo(decorArr[i],"y");
		var z = GetItemInfo(decorArr[i],"z");
		var id = GetItemInfo(decorArr[i],"id");
		var size = GetItemInfo(decorArr[i],"size");
		var flip = GetItemInfo(decorArr[i],"flip");
		var imgSlot;
		if(flip == 0){
			imgSlot = GetImageSlot(GetItemInfo(tankItems[parseInt(id)],"image"));
		}else{
			imgSlot = GetImageSlot(GetItemInfo(tankItems[parseInt(id)],"imagef"));
		}
		var iWidth = (tankImgs[imgSlot].width * relSize)*(z/90+size/2);
		var iHeight = (tankImgs[imgSlot].height * relSize)*(z/90+size/2);
		var sandW = relSize*tankImgs[0].width;
		var sandH = relSize*tankImgs[0].height;
		var topSand = (canvas.height/2)+sandH/4;
		var bottomSand = (canvas.height/2)+sandH/2.8;
		if(tank == selectedTank){
			itemSlotOver = GetItemAtPos(decorArr,canvas,relSize,xOffset,yOffset,topSand);
		}
		//topsand draw
		ctx.beginPath();
		ctx.moveTo(0, topSand);
		ctx.lineTo(10000,topSand);
		//ctx.stroke();
		//bottomsand draw
		ctx.beginPath();
		ctx.moveTo(0, bottomSand);
		ctx.lineTo(10000,bottomSand);
		//ctx.stroke();
		if(movingItemSlot == i && tank == selectedTank){
			ctx.globalAlpha = 0.6;
		}else{
			ctx.globalAlpha = 1;
		}
		ctx.drawImage(tankImgs[imgSlot],(canvas.width/2-GetItemInfo(tankItems[id],"x")*(z*(x/-100)/100+size/2)*relSize+x*relSize)-(xOffset/5)*(5-z/10)*relSize,(topSand-GetItemInfo(tankItems[id],"y")*(z/100+size/2)*relSize+z*relSize)-((yOffset/25)*(5-z/10)/yMult)*relSize,iWidth,iHeight);
		if((itemSlotOver == i && tank == selectedTank && movingItemSlot == -1) || (movingItemSlot == i && tank == selectedTank)){
			hoverLeft = (canvas.width/2-GetItemInfo(tankItems[id],"x")*(z*(x/-100)/100+size/2)*relSize+x*relSize)-(xOffset/5)*(5-z/10)*relSize;
			hoverTop = (topSand-GetItemInfo(tankItems[id],"y")*(z/100+size/2)*relSize+z*relSize)-((yOffset/25)*(5-z/10)/yMult)*relSize;
			hoverWidth = iWidth;
			hoverHeight = iHeight;
		}
		ctx.globalAlpha = 1;
	}
}
function UpdateCursor(){
	if(cursor == 0){
		document.body.style.cursor = "default";
	}
	if(cursor == 1){
		document.body.style.cursor = "pointer";
	}
	if(cursor == 2){
		document.body.style.cursor = "move";
	}
}
function repeat(){
	setInterval(function(){
	UpdateCursor();
	cursor = 0;
	if(movingItemSlot == -1){
		tankDecor[selectedTank].sort(sortFunction);
	}
	//Window size details
	var width = document.body.clientWidth;

	var height = document.body.clientHeight;
	for(i = 0; i < aquariums.length; i++){
		if(i != selectedTank){
			var canvas = aquariums[i];
			var ctx = canvas.getContext("2d");
		}else{
			var canvas = document.getElementById("selectedaquarium");
			var ctx = canvas.getContext("2d");
			var selected = aquariums[i].getContext("2d");
			selected.fillStyle = "#3d3d3d";
			selected.fillRect(0,0,selected.canvas.width,selected.canvas.height);
			selected.drawImage(tankImgs[1],0,0,selected.canvas.width ,selected.canvas.height);
		}
		var bgWidth = canvas.width * .75;
		var bgHeight = canvas.height * .75;
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		ctx.lineWidth = 1;
		ctx.fillStyle = "#70adb3";
		ctx.strokeStyle = "#25393b";
		var c = canvas.getBoundingClientRect();
		
		var xOffset = ((c.left + canvas.width/2) - (width/2))/5;
		var yOffset = ((c.top + canvas.height/2) - (height/2))/5;
		
		var scroller = document.getElementById("aquariums");
		
		var relativeSizing = (canvas.width / 1000);
		
		var grd = ctx.createLinearGradient(-800, 800, 800, -800);
		grd.addColorStop(0, "#8ad4db");
		grd.addColorStop(.1, "#25393b");
		grd.addColorStop(1, "#8ad4db");
		ctx.fillStyle = grd;
		ctx.fillRect(0,0,canvas.width,canvas.height);
		ctx.fillStyle = "#487378";
		ctx.fillRect((canvas.width/2-bgWidth/2)-xOffset*relativeSizing,(canvas.height/2-bgHeight/2)-((yOffset/5)/yMult)*relativeSizing,bgWidth,bgHeight);
		ctx.strokeRect((canvas.width/2-bgWidth/2)-xOffset*relativeSizing,(canvas.height/2-bgHeight/2)-((yOffset/5)/yMult)*relativeSizing,bgWidth,bgHeight);
		
		//topleft tank
		ctx.beginPath();
		ctx.moveTo(0, 0);
		ctx.lineTo((canvas.width/2-bgWidth/2)-xOffset*relativeSizing,(canvas.height/2-bgHeight/2)-((yOffset/5)/yMult)*relativeSizing);
		ctx.stroke();
		
		//topright tank
		ctx.beginPath();
		ctx.moveTo(canvas.width, 0);
		ctx.lineTo((canvas.width/2+bgWidth/2)-xOffset*relativeSizing,(canvas.height/2-bgHeight/2)-((yOffset/5)/yMult)*relativeSizing);
		ctx.stroke();
		
		//bottomleft tank
		ctx.beginPath();
		ctx.moveTo(0, canvas.height);
		ctx.lineTo((canvas.width/2-bgWidth/2)-xOffset*relativeSizing,(canvas.height/2+bgHeight/2)-((yOffset/5)/yMult)*relativeSizing);
		ctx.stroke();
		
		//bottomright tank
		ctx.beginPath();
		ctx.moveTo(canvas.width, canvas.height);
		ctx.lineTo((canvas.width/2+bgWidth/2)-xOffset*relativeSizing,(canvas.height/2+bgHeight/2)-((yOffset/5)/yMult)*relativeSizing);
		ctx.stroke();
		
		var sandW = relativeSizing*tankImgs[2].width;
		var sandH = relativeSizing*tankImgs[2].height;
		var sandFW = relativeSizing*tankImgs[3].width;
		var sandFH = relativeSizing*tankImgs[3].height;
		
		ctx.drawImage(tankImgs[GetImageSlot("sb0001.png")],(canvas.width/2-sandW/2)-xOffset*relativeSizing,(canvas.height/2-sandH/2.5)-((yOffset/5)/yMult)*(relativeSizing),sandW,sandH);
		DrawTankItems(i,tankDecor[i],canvas,relativeSizing,xOffset,yOffset);
		ctx.drawImage(tankImgs[GetImageSlot("sf0002.png")],0,0,canvas.width ,sandFH);
		ctx.drawImage(tankImgs[GetImageSlot("shine1.png")],0,0,canvas.width ,canvas.height);
		ctx.strokeStyle = "#25393b";
		ctx.lineWidth = 3;
		if(movingItemSlot == -1){
			ctx.globalAlpha = 0.6;
		}else{
			ctx.globalAlpha = 1;
		}
		ctx.strokeRect(hoverLeft,hoverTop,hoverWidth,hoverHeight);
		ctx.globalAlpha = 1;
		hoverTop = -1000;
		hoverLeft = -1000;
		if(itemSlotOver != -1 || overTank){
			cursor = 1;
		}
		if(movingItemSlot != -1){
			cursor = 2;
		}
	}
	if(mousePrevY != mouseY || mousePrevX != mouseX){
		if(movingItemSlot >= 0){
			var x = parseInt(GetItemInfo(tankDecor[selectedTank][movingItemSlot],"x")) + (mouseX-mousePrevX)*1.1;
			var z = parseInt(GetItemInfo(tankDecor[selectedTank][movingItemSlot],"z")) + (mouseY-mousePrevY)*1.1;
			var width = GetItemInfo(tankItems[GetItemInfo(tankDecor[selectedTank][movingItemSlot],"id")],"width")/2;
			

			if(x>400-width){
				x = 400-width;
			}
			if(x<-400+width){
				x = -400+width;
			}
			if(z>50){
				z = 50;
			}
			if(z<0){
				z = 0;
			}
			//window.alert("x:" + (mouseX-mousePrevX) + " z:" + (mouseY-mousePrevY));
			SetItemInfo(tankDecor[selectedTank][movingItemSlot],"x",x);
			SetItemInfo(tankDecor[selectedTank][movingItemSlot],"z",z);
		}
		mousePrevY = mouseY;
		mousePrevX = mouseX;
	}
	},30);
}
window.onload = function() {
	DecorateAll();
	preloadTankImages();
	repeat();
}
function preloadTankImages() {
tankImgs[0] = new Image();
tankImgs[0].src = "shine1.png";
tankImgs[1] = new Image();
tankImgs[1].src = "selected.png";
	var index = 2;
	for (i1 = 0; i1 < tankItems.length; i1++) {
		var imgNames = GetItemInfo(tankItems[i1],"image");
		for(i2=0;i2<imgNames.length;i2++){
			tankImgs[index] = new Image();
			tankImgs[index].src = imgNames[i2];
			index += 1;
		}
		imgNames = GetItemInfo(tankItems[i1],"imagef");
		for(i2=0;i2<imgNames.length;i2++){
			tankImgs[index] = new Image();
			tankImgs[index].src = imgNames[i2];
			index += 1;
		}
		//window.alert(tankImgs);
	}
	
}
function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}
</script>

</body>
</html>